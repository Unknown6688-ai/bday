<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Who's Birthday? â€” Surprise</title>
  <style>
    :root{
      --bg1:#fffaf6;
      --bg2:#f0f8ff;
      --accent:#ff6fa3;
      --accent2:#7c5cff;
      --panel-pad:22px;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#111;overflow:hidden}
    /* Respect iPhone safe area */
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:calc(24px + env(safe-area-inset-top,0)) 18px calc(24px + env(safe-area-inset-bottom,0));}
    .panel{
      width:100%;
      max-width:920px;
      background:rgba(255,255,255,0.98);
      border-radius:18px;
      padding:var(--panel-pad);
      box-shadow:0 20px 50px rgba(20,20,50,0.06);
      position:relative;
      overflow:hidden;
      /* allow the panel to shrink on smaller screens */
      max-height: calc(100vh - 48px);
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .heading{font-size:1.6rem;font-weight:900;text-align:center;margin:0 0 2px}
    .sub{color:#555;text-align:center;margin:0 0 8px;font-size:0.95rem}

    /* Make optionsStage responsive using viewport height (works better on mobile) */
    .optionsStage{
      height: min(46vh,420px);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(250,250,255,0.6));
      padding:8px;
    }

    .optionBtn{
      position:absolute;
      padding:14px 18px;
      border-radius:999px;
      border:0;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:white;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 10px 26px rgba(124,92,255,0.12);
      user-select:none;
      transition:transform 0.35s ease,left 0.35s ease,top 0.35s ease;
      touch-action:manipulation;
      font-size:1rem;
      line-height:1;
      white-space:nowrap;
      max-width:82%;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .optionBtn:active{transform:scale(.96)}
    .hint{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;color:#666;font-size:13px}

    .wishStage{display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center;overflow:auto}
    .wishTitle{font-size:2.25rem;color:var(--accent);font-weight:900;margin:6px}
    .cake{font-size:5.5rem;margin-top:8px;line-height:1}
    .lines{margin-top:16px;display:flex;flex-direction:column;gap:10px;align-items:center;width:100%}
    .line{background:linear-gradient(180deg,#fff,#fbfbff);padding:12px 18px;border-radius:12px;max-width:860px;box-shadow:0 6px 18px rgba(20,20,50,0.04);opacity:0;transform:translateY(10px);transition:all 500ms cubic-bezier(.2,.9,.3,1);font-size:0.98rem}
    .line.show{opacity:1;transform:translateY(0)}

    /* confetti pieces */
    .confetti{position:absolute;width:10px;height:14px;border-radius:3px;opacity:0.95;transform-origin:center;animation:fall linear forwards}
    @keyframes fall { to { transform: translateY(120vh) rotate(720deg); opacity:0.95 } }

    /* Small controls removed on mobile; keep layout neat */
    @media (max-width:640px){
      .optionBtn{padding:12px 14px;font-size:0.95rem}
      .wishTitle{font-size:1.65rem}
      .optionsStage{height:46vh}
      .cake{font-size:4rem}
      .panel{padding:16px}
    }

    /* If the device is extremely short, allow scrolling inside panel */
    @media (max-height:520px){
      .panel{max-height:calc(100vh - 20px);overflow:auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" id="panel">
      <h1 class="heading">Whose Birthday Is It??</h1>
      <div class="sub">Watch closely, names move around â€” only the right one opens the surprise!</div>

      <div class="optionsStage" id="optionsStage" aria-label="Options stage"></div>

      <div class="wishStage" id="wishStage" aria-hidden="true">
        <div class="wishTitle">Happy Birthday, Punjaban! ðŸŽ‰</div>
        <div class="cake" aria-hidden="true">ðŸŽ‚</div>
        <div class="lines" id="wishLines"></div>
      </div>

      <!-- background audio (kept, but change-music control removed) -->
      <audio id="bgAudio" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2021/10/17/audio_e5f3e1b7b1.mp3?filename=soft-piano-10748.mp3"></audio>
    </div>
  </div>

  <script>
    // options & messages
    const allOptions = [
      { label: "It's Ishu's", id: 'ishu' },
      { label: "It's Ishmeet's", id: 'ishmeet' },
      { label: "It's Kaleshi's ðŸ˜‚", id: 'kaleshi' },
      { label: "It's Punjaban's", id: 'punjaban' }
    ];

    const sweetLines = [
      "Wishing you a day filled with love and laughter.",
      "May all your dreams find their way to you this year.",
      "Get Drunk Alot And Make Some Butt Calls To Randoms Enjoy Your Day Anyways This Is Your Full Day Job ðŸ˜‚.",
      "Don't Change Yourself From Someone's Advice World Needs Some Cute Kaleshis In It."
    ];

    const optionsStage = document.getElementById('optionsStage');
    const wishStage = document.getElementById('wishStage');
    const wishLinesWrap = document.getElementById('wishLines');
    const bgAudio = document.getElementById('bgAudio');

    const btnElements = {};
    let visibleIds = [];
    let clickCounter = 0;
    const PUNJABEN_UNLOCK_AFTER = 5;

    // create buttons
    function makeButtons(){
      allOptions.forEach(opt=>{
        const b = document.createElement('button');
        b.className = 'optionBtn';
        b.textContent = opt.label;
        b.dataset.id = opt.id;
        b.style.display = 'none';
        b.style.left = '0px';
        b.style.top = '0px';
        b.addEventListener('click', ()=> onClickOption(opt.id));
        // ensure touch-friendly focus outlines & accessibility
        b.setAttribute('aria-label', opt.label);
        optionsStage.appendChild(b);
        btnElements[opt.id] = b;
      });
    }

    function pickVisibleIds(){
      const pool = allOptions.map(o => o.id).filter(id => {
        if(id === 'punjaban' && clickCounter < PUNJABEN_UNLOCK_AFTER) return false;
        return true;
      });

      const count = Math.random() < 0.45 ? 2 : 1;
      const chosen = [];
      const copy = pool.slice();
      while(chosen.length < count && copy.length){
        const idx = Math.floor(Math.random() * copy.length);
        chosen.push(copy.splice(idx,1)[0]);
      }
      return chosen;
    }

    function showIds(ids){
      allOptions.forEach(o => { btnElements[o.id].style.display = 'none'; });
      visibleIds = ids.slice();
      ids.forEach(id => {
        const el = btnElements[id];
        el.style.display = 'block';
        positionElementRandom(el);
        el.style.pointerEvents = 'auto';
      });
    }

    function positionElementRandom(el){
      // ensure element is measured after layout
      const rect = optionsStage.getBoundingClientRect();
      // allow small padding relative to stage size
      const padX = Math.max(8, rect.width * 0.03);
      const padY = Math.max(8, rect.height * 0.03);

      // clamp maximum width for button so it does not overflow stage
      el.style.maxWidth = Math.max(120, Math.min(rect.width - padX*2, el.offsetWidth)) + 'px';

      const maxX = Math.max(40, rect.width - el.offsetWidth - padX);
      const maxY = Math.max(40, rect.height - el.offsetHeight - padY);
      const nx = padX + Math.random() * maxX;
      const ny = padY + Math.random() * maxY;
      el.style.left = nx + 'px';
      el.style.top = ny + 'px';
    }

    function startDrift(){
      setInterval(()=>{
        visibleIds.forEach(id=>{
          const el = btnElements[id];
          if(!el || el.style.display === 'none') return;
          const dx = (Math.random()-0.5) * 18;
          const dy = (Math.random()-0.5) * 12;
          const curLeft = parseFloat(el.style.left) || 0;
          const curTop = parseFloat(el.style.top) || 0;
          const rect = optionsStage.getBoundingClientRect();
          const pad = 8;
          let nx = curLeft + dx;
          let ny = curTop + dy;
          nx = Math.max(pad, Math.min(rect.width - el.offsetWidth - pad, nx));
          ny = Math.max(pad, Math.min(rect.height - el.offsetHeight - pad, ny));
          el.style.left = nx + 'px';
          el.style.top = ny + 'px';
        });
      }, 420);
    }

    function startJumps(){
      setInterval(()=>{
        if(visibleIds.length === 0) return;
        const pick = visibleIds[Math.floor(Math.random()*visibleIds.length)];
        const el = btnElements[pick];
        if(!el) return;
        positionElementRandom(el);
        el.style.transform = 'scale(1.06)';
        setTimeout(()=> el.style.transform = '', 300);
      }, 1000 + Math.random()*800);
    }

    function startSwapCycle(){
      setInterval(()=>{
        const next = pickVisibleIds();
        if(JSON.stringify(next) !== JSON.stringify(visibleIds)){
          showIds(next);
        } else {
          next.forEach(id => positionElementRandom(btnElements[id]));
        }
      }, 1200 + Math.random()*900);
    }

    function onClickOption(id){
      clickCounter++;
      const el = btnElements[id];
      if(el){
        el.style.transition = 'transform 140ms cubic-bezier(.2,.9,.3,1)';
        el.style.transform = 'translateY(-6px) scale(1.02)';
        setTimeout(()=> el.style.transform = '', 220);
      }

      if(id !== 'punjaban'){
        const others = visibleIds.filter(x => x !== id);
        if(others.length){
          const other = btnElements[others[Math.floor(Math.random()*others.length)]];
          if(other) positionElementRandom(other);
        }
      }

      if(id === 'punjaban'){
        spawnMiniBurst();
        setTimeout(()=> openWishStage(), 700);
      }
    }

    function spawnMiniBurst(){
      const count = 20;
      for(let i=0;i<count;i++){
        const c = document.createElement('div'); c.className = 'confetti';
        const size = 6 + Math.random()*12; c.style.width = size + 'px'; c.style.height = (size*1.2) + 'px';
        c.style.left = (30 + (Math.random()-0.5)*40) + '%';
        c.style.top = (10 + Math.random()*20) + '%';
        c.style.background = ['#FF6FA3','#FFD166','#06D6A0','#4D9CFF','#B388FF'][Math.floor(Math.random()*5)];
        c.style.animationDuration = (1.6 + Math.random()*1.4) + 's';
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        optionsStage.appendChild(c);
        setTimeout(()=> c.remove(), 2800);
      }
    }

    async function openWishStage(){
      visibleIds.forEach(id => {
        const el = btnElements[id];
        if(el) el.style.pointerEvents = 'none';
      });
      optionsStage.style.transition = 'opacity 420ms ease';
      optionsStage.style.opacity = 0;
      setTimeout(()=>{
        optionsStage.style.display = 'none';
        showWish();
      }, 460);
    }

    async function showWish(){
      wishStage.style.display = 'flex';
      wishStage.style.opacity = 0;
      wishStage.style.transition = 'opacity 420ms ease';
      setTimeout(()=> wishStage.style.opacity = 1, 20);
      try{ await bgAudio.play(); }catch(e){}
      wishLinesWrap.innerHTML = '';
      for(let i=0;i<sweetLines.length;i++){
        const d = document.createElement('div'); d.className = 'line'; d.textContent = sweetLines[i];
        wishLinesWrap.appendChild(d);
        await sleep(400);
        d.classList.add('show');
        if(i===0 || i===2) spawnFullScreenConfetti();
        await sleep(1200);
      }
    }

    function spawnFullScreenConfetti(){
      const panel = document.getElementById('panel');
      for(let i=0;i<40;i++){
        const c = document.createElement('div'); c.className='confetti';
        const size = 6 + Math.random()*14; c.style.width = size+'px'; c.style.height = (size*1.3)+'px';
        c.style.left = (5 + Math.random()*90)+'%';
        c.style.top = (-10 + Math.random()*30)+'%';
        c.style.background = ['#FF6FA3','#FFD166','#06D6A0','#4D9CFF','#B388FF'][Math.floor(Math.random()*5)];
        c.style.animationDuration = (2.2 + Math.random()*1.6)+'s';
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        panel.appendChild(c);
        setTimeout(()=> c.remove(), 4200);
      }
    }

    // helper sleep
    function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

    // init
    makeButtons();
    function pickInitialIds(){
      const pool = allOptions.map(o=>o.id).filter(id=> id !== 'punjaban');
      const count = Math.random()<0.45 ? 2 : 1;
      const chosen = [];
      const copy = pool.slice();
      while(chosen.length < count && copy.length){
        const idx = Math.floor(Math.random()*copy.length);
        chosen.push(copy.splice(idx,1)[0]);
      }
      return chosen;
    }
    showIds(pickInitialIds());
    startDrift();
    startSwapCycle();
    startJumps();

    // try autoplay on load (may be blocked)
    window.addEventListener('load', ()=> { bgAudio.play().catch(()=>{}); });

    // if unlocked, occasionally bring punjaban in
    setInterval(()=>{
      if(clickCounter >= PUNJABEN_UNLOCK_AFTER && !visibleIds.includes('punjaban')){
        if(Math.random() < 0.3){
          const next = pickVisibleIds();
          showIds(next);
        }
      }
    }, 600);

    // reposition on resize / orientation change
    let _rt = null;
    window.addEventListener('resize', ()=>{ clearTimeout(_rt); _rt = setTimeout(()=> {
      visibleIds.forEach(id => positionElementRandom(btnElements[id]));
    }, 120); });

    // orientationchange for mobile (some browsers report different sizes)
    window.addEventListener('orientationchange', ()=> {
      setTimeout(()=> visibleIds.forEach(id => positionElementRandom(btnElements[id])), 250);
    });
  </script>
</body>
</html>
